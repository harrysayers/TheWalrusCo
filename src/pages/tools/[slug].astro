---
// Redirect /tools/[slug] to /tools/[slug]/ (with trailing slash)
// This ensures relative paths in the HTML work correctly
const { slug } = Astro.params;

// Check if URL has trailing slash, if not redirect to add it
if (!Astro.url.pathname.endsWith('/')) {
  return Astro.redirect(`/tools/${slug}/`, 301);
}

// Read the HTML file - handle both dev and production
try {
  let html;

  if (import.meta.env.DEV) {
    // In dev, read from filesystem
    const fs = await import('node:fs/promises');
    const path = await import('node:path');
    const filePath = path.join(process.cwd(), 'public', 'tools', slug, 'index.html');
    html = await fs.readFile(filePath, 'utf-8');
  } else {
    // In production (Vercel), fetch the static file
    const toolUrl = new URL(`/tools/${slug}/index.html`, Astro.site || Astro.url.origin);
    const response = await fetch(toolUrl);

    if (!response.ok) {
      return new Response('Tool not found', { status: 404 });
    }

    html = await response.text();
  }

  return new Response(html, {
    status: 200,
    headers: {
      'Content-Type': 'text/html; charset=utf-8',
    },
  });
} catch (error) {
  return new Response('Tool not found', { status: 404 });
}
---
