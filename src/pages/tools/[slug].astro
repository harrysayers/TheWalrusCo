---
// Redirect /tools/[slug] to /tools/[slug]/ (with trailing slash)
// This ensures relative paths in the HTML work correctly
const { slug } = Astro.params;

// Check if URL has trailing slash, if not redirect to add it
if (!Astro.url.pathname.endsWith('/')) {
  return Astro.redirect(`/tools/${slug}/`);
}

// Read the HTML file from the public directory
// Use different paths for dev vs production
import { fileURLToPath } from 'node:url';
import { dirname, join } from 'node:path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// In production (Vercel), public files are in dist/client
// In dev, they're in public/
const publicDir = import.meta.env.PROD
  ? join(__dirname, '../../client')
  : join(process.cwd(), 'public');

const filePath = join(publicDir, 'tools', slug, 'index.html');

try {
  const fs = await import('node:fs/promises');
  const html = await fs.readFile(filePath, 'utf-8');

  return new Response(html, {
    status: 200,
    headers: {
      'Content-Type': 'text/html',
    },
  });
} catch (error) {
  return new Response('Tool not found', { status: 404 });
}
---
